{"ast":null,"code":"import _objectSpread from\"Y:/Coding/bizCards/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"Y:/Coding/bizCards/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"Y:/Coding/bizCards/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _createForOfIteratorHelper from\"Y:/Coding/bizCards/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _slicedToArray from\"Y:/Coding/bizCards/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import PageHeader from\"./common/pageHeader\";import Input from\"./common/input\";import{useFormik}from\"formik\";import Joi from\"joi\";import{Navigate,useNavigate}from\"react-router-dom\";import{useState}from\"react\";import{useAuth}from\"../contexts/auth.context\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var SignIn=function SignIn(_ref){var redirect=_ref.redirect;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),serverError=_useState2[0],setServerError=_useState2[1];var navigate=useNavigate();var _useAuth=useAuth(),user=_useAuth.user,login=_useAuth.login;var form=useFormik({validateOnMount:true,initialValues:{email:\"\",password:\"\"},validate:function validate(values){var schema=Joi.object({email:Joi.string().min(2).max(255).required().email({tlds:{allow:false}}),password:Joi.string().min(6).max(1024).required()});var _schema$validate=schema.validate(values,{abortEarly:false}),error=_schema$validate.error;if(!error){return null;}var errors={};var _iterator=_createForOfIteratorHelper(error.details),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var detail=_step.value;var key=detail.path[0];errors[key]=detail.message;}}catch(err){_iterator.e(err);}finally{_iterator.f();}return errors;},onSubmit:function onSubmit(values){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _err$response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return login(values);case 3:if(redirect){navigate(redirect);}_context.next=9;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);if(((_err$response=_context.t0.response)===null||_err$response===void 0?void 0:_err$response.status)===400){setServerError(_context.t0.response.data);}case 9:case\"end\":return _context.stop();}},_callee,null,[[0,6]]);}))();}});function getFieldProps(name){return _objectSpread(_objectSpread({},form.getFieldProps(name)),{},{error:form.touched[name]&&form.errors[name]});}if(user){return/*#__PURE__*/_jsx(Navigate,{to:\"/\"});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(PageHeader,{title:\"Sign In\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:form.handleSubmit,children:[serverError&&/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger\",children:serverError}),/*#__PURE__*/_jsx(Input,_objectSpread(_objectSpread({},getFieldProps(\"email\")),{},{label:\"Email\",type:\"email\",required:true})),/*#__PURE__*/_jsx(Input,_objectSpread(_objectSpread({},getFieldProps(\"password\")),{},{label:\"Password\",type:\"password\",required:true})),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:!form.isValid,className:\"btn btn-primary mt-2\",children:\"Log-in\"})]})]});};export default SignIn;","map":{"version":3,"names":["PageHeader","Input","useFormik","Joi","Navigate","useNavigate","useState","useAuth","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","SignIn","_ref","redirect","_useState","_useState2","_slicedToArray","serverError","setServerError","navigate","_useAuth","user","login","form","validateOnMount","initialValues","email","password","validate","values","schema","object","string","min","max","required","tlds","allow","_schema$validate","abortEarly","error","errors","_iterator","_createForOfIteratorHelper","details","_step","s","n","done","detail","value","key","path","message","err","e","f","onSubmit","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_err$response","wrap","_callee$","_context","prev","next","t0","response","status","data","stop","getFieldProps","name","_objectSpread","touched","to","children","title","handleSubmit","className","label","type","disabled","isValid"],"sources":["Y:/Coding/bizCards/src/components/signIn.jsx"],"sourcesContent":["import PageHeader from \"./common/pageHeader\";\r\nimport Input from \"./common/input\";\r\nimport { useFormik } from \"formik\";\r\nimport Joi from \"joi\";\r\nimport { Navigate, useNavigate } from \"react-router-dom\";\r\nimport { useState } from \"react\";\r\nimport { useAuth } from \"../contexts/auth.context\";\r\n\r\nconst SignIn = ({ redirect }) => {\r\n   const [serverError, setServerError] = useState(\"\");\r\n   const navigate = useNavigate();\r\n   const { user, login } = useAuth();\r\n\r\n   const form = useFormik({\r\n      validateOnMount: true,\r\n      initialValues: { email: \"\", password: \"\" },\r\n      validate(values) {\r\n         const schema = Joi.object({\r\n            email: Joi.string()\r\n               .min(2)\r\n               .max(255)\r\n               .required()\r\n               .email({ tlds: { allow: false } }),\r\n            password: Joi.string().min(6).max(1024).required(),\r\n         });\r\n         const { error } = schema.validate(values, { abortEarly: false });\r\n         if (!error) {\r\n            return null;\r\n         }\r\n\r\n         const errors = {};\r\n\r\n         for (const detail of error.details) {\r\n            const key = detail.path[0];\r\n            errors[key] = detail.message;\r\n         }\r\n\r\n         return errors;\r\n      },\r\n      async onSubmit(values) {\r\n         try {\r\n            await login(values);\r\n\r\n            if (redirect) {\r\n               navigate(redirect);\r\n            }\r\n         } catch (err) {\r\n            if (err.response?.status === 400) {\r\n               setServerError(err.response.data);\r\n            }\r\n         }\r\n      },\r\n   });\r\n\r\n   function getFieldProps(name) {\r\n      return {\r\n         ...form.getFieldProps(name),\r\n         error: form.touched[name] && form.errors[name],\r\n      };\r\n   }\r\n\r\n   if (user) {\r\n      return <Navigate to={\"/\"} />;\r\n   }\r\n\r\n   return (\r\n      <>\r\n         <PageHeader title={\"Sign In\"} />\r\n         <form onSubmit={form.handleSubmit}>\r\n            {serverError && (\r\n               <div className=\"alert alert-danger\">{serverError}</div>\r\n            )}\r\n\r\n            <Input\r\n               {...getFieldProps(\"email\")}\r\n               label={\"Email\"}\r\n               type={\"email\"}\r\n               required\r\n            />\r\n            <Input\r\n               {...getFieldProps(\"password\")}\r\n               label={\"Password\"}\r\n               type={\"password\"}\r\n               required\r\n            />\r\n            <button\r\n               type=\"submit\"\r\n               disabled={!form.isValid}\r\n               className=\"btn btn-primary mt-2\"\r\n            >\r\n               Log-in\r\n            </button>\r\n         </form>\r\n      </>\r\n   );\r\n};\r\n\r\nexport default SignIn;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}